# JellyWatch Installer Implementation Plan

**Created:** 2026-01-02
**Status:** In Progress

---

## Overview

Interactive TUI installer for JellyWatch using Go + Bubbletea. Supports both install and uninstall modes with configuration input, API testing, and systemd integration.

---

## Visual Design

### Color Scheme (Jellyfin Theme)
```go
Primary      = "#AA5CC3"  // Purple (gradient start, highlights)
Secondary    = "#00A4DC"  // Cyan/Blue (gradient end, accent)
BgBase       = "#101010"  // Dark background
FgPrimary    = "#FFFFFF"  // White text
FgMuted      = "#888888"  // Muted text
ErrorColor   = "#FF5555"  // Red for errors
SuccessColor = "#00A4DC"  // Cyan for success (matches Jellyfin)
```

### ASCII Banner
```
  ▀▀        ▀██   ▀██                        ▄▄          ██    
 ▀██ ██▀▀██  ██    ██  ██  ██ ██ ▄ █ ▀▀▀▀██ ▀██▀▀ ██▀▀██ ██▀▀██
  ██ ██▀▀▀▀  ██    ██  ██  ██ ██▄█▄█ ██▀▀██  ██   ██  ▄▄ ██  ██
  ██ ▀▀▀▀▀▀ ▀▀▀▀  ▀▀▀▀ ▀▀▀▀██ ▀▀▀▀▀▀ ▀▀▀▀▀▀  ▀▀▀▀ ▀▀▀▀▀▀ ▀▀  ▀▀
▀▀▀▀                   ▀▀▀▀▀▀                                  
```

---

## User Flow

```
Step 1: WELCOME
  ├─► Install jellywatch
  │     │
  │     ▼
  │   Step 2: WATCH DIRECTORIES (TV path, Movies path)
  │     │
  │     ▼
  │   Step 3: LIBRARY PATHS (TV library, Movies library)
  │     │
  │     ▼
  │   Step 4: SONARR (enable, URL, API key, test)
  │     │
  │     ▼
  │   Step 5: RADARR (enable, URL, API key, test)
  │     │
  │     ▼
  │   Step 6: CONFIRM (review settings)
  │     │
  │     ▼
  │   Step 7: INSTALLING (task progress)
  │     │
  │     ▼
  │   Step 8: COMPLETE (success/next steps)
  │
  └─► Uninstall jellywatch
        │
        ▼
      UNINSTALL TASKS (stop, disable, remove)
        │
        ▼
      COMPLETE (config preserved)
```

---

## Installation Tasks (Install Mode)

| # | Task | Description | Critical |
|---|------|-------------|----------|
| 1 | Check privileges | Verify running as root/sudo | Yes |
| 2 | Build binaries | `go build ./cmd/jellywatch` and `./cmd/jellywatchd` | Yes |
| 3 | Install binaries | Copy to `/usr/local/bin/` with 755 permissions | Yes |
| 4 | Create config dir | `~/.config/jellywatch/` with proper ownership | Yes |
| 5 | Create logs dir | `~/.config/jellywatch/logs/` with proper ownership | Yes |
| 6 | Backup existing config | If exists, copy to `config.toml.backup` | Yes |
| 7 | Write configuration | Generate TOML from user inputs | Yes |
| 8 | Install systemd | Copy service file to `/etc/systemd/system/` | Yes |
| 9 | Reload systemd | `systemctl daemon-reload` | Yes |
| 10 | Enable service | `systemctl enable jellywatchd` | Yes |
| 11 | Start service | `systemctl start jellywatchd` | Yes |

---

## Uninstall Tasks

| # | Task | Description | Critical |
|---|------|-------------|----------|
| 1 | Check privileges | Verify running as root/sudo | Yes |
| 2 | Stop service | `systemctl stop jellywatchd` | Optional |
| 3 | Disable service | `systemctl disable jellywatchd` | Optional |
| 4 | Remove binaries | Delete from `/usr/local/bin/` | Yes |
| 5 | Remove systemd files | Delete service file | Yes |
| 6 | Reload systemd | `systemctl daemon-reload` | Yes |

**Note:** Config preserved at `~/.config/jellywatch/`

---

## API Test Implementation

### Sonarr Test
```go
// GET http://{url}/api/v3/system/status
// Header: X-Api-Key: {apikey}
// Success: 200 OK with JSON containing "version"
```

### Radarr Test
```go
// GET http://{url}/api/v3/system/status
// Header: X-Api-Key: {apikey}
// Success: 200 OK with JSON containing "version"
```

---

## Generated Config Format

```toml
# JellyWatch Configuration
# Generated by installer on 2026-01-02

[watch]
tv = ["/mnt/downloads/tv"]
movies = ["/mnt/downloads/movies"]

[libraries]
tv = ["/mnt/media/TV Shows"]
movies = ["/mnt/media/Movies"]

[sonarr]
enabled = true
url = "http://localhost:8989"
api_key = "abc123..."

[radarr]
enabled = true
url = "http://localhost:7878"
api_key = "xyz789..."

[daemon]
enabled = true
scan_frequency = "5m"
health_addr = ":8686"

[options]
dry_run = false
delete_source = true
```

---

## Implementation Phases

### Phase 1: Foundation
**Goal:** Basic installer structure with Bubbletea, colors, and navigation

| Task | Description | Status |
|------|-------------|--------|
| 1.1 | Add Bubbletea dependencies to `go.mod` | Pending |
| 1.2 | Create `cmd/installer/main.go` with model struct, step constants, color theme | Pending |
| 1.3 | Implement Welcome screen (Install/Uninstall selection) | Pending |
| 1.4 | Implement basic View() with ASCII banner and help text | Pending |
| 1.5 | Wire up keyboard navigation (↑/↓/Enter/Q) | Pending |

**Deliverable:** Installer launches, shows banner, user can select Install/Uninstall and quit

---

### Phase 2: Configuration Input Screens
**Goal:** Interactive forms for user configuration

| Task | Description | Status |
|------|-------------|--------|
| 2.1 | Create text input component (reusable for all path/URL fields) | Pending |
| 2.2 | Implement Watch Directories screen (TV path, Movies path) | Pending |
| 2.3 | Implement Library Paths screen (TV library, Movies library) | Pending |
| 2.4 | Implement Sonarr screen (enable toggle, URL, API key, test button) | Pending |
| 2.5 | Implement Radarr screen (enable toggle, URL, API key, test button) | Pending |
| 2.6 | Implement Confirmation screen (review all settings) | Pending |

**Deliverable:** User can navigate through all config screens, enter values, go back/forward

---

### Phase 3: API Testing
**Goal:** Test Sonarr/Radarr connections with visual feedback

| Task | Description | Status |
|------|-------------|--------|
| 3.1 | Implement Sonarr API test (GET /api/v3/system/status) | Pending |
| 3.2 | Implement Radarr API test (GET /api/v3/system/status) | Pending |
| 3.3 | Add async test execution with spinner | Pending |
| 3.4 | Display success (checkmark + version) or failure (X + error) | Pending |

**Deliverable:** User can test connections, sees pass/fail with version info

---

### Phase 4: Installation Tasks
**Goal:** Execute actual installation steps

| Task | Description | Status |
|------|-------------|--------|
| 4.1 | Implement task runner with status tracking (pending/running/complete/failed) | Pending |
| 4.2 | Task: Check privileges (root/sudo) | Pending |
| 4.3 | Task: Build binaries (`go build`) | Pending |
| 4.4 | Task: Install binaries to `/usr/local/bin/` | Pending |
| 4.5 | Task: Create config directory + logs directory | Pending |
| 4.6 | Task: Backup existing config (if exists) | Pending |
| 4.7 | Task: Write config.toml from user inputs | Pending |
| 4.8 | Task: Install systemd service file | Pending |
| 4.9 | Task: Reload systemd, enable and start service | Pending |
| 4.10 | Implement Installing screen with progress display | Pending |

**Deliverable:** Full install flow executes, shows progress, handles errors

---

### Phase 5: Uninstall Flow
**Goal:** Clean removal of JellyWatch

| Task | Description | Status |
|------|-------------|--------|
| 5.1 | Task: Stop service | Pending |
| 5.2 | Task: Disable service | Pending |
| 5.3 | Task: Remove binaries | Pending |
| 5.4 | Task: Remove systemd files | Pending |
| 5.5 | Task: Reload systemd | Pending |
| 5.6 | Implement uninstall complete screen (note: config preserved) | Pending |

**Deliverable:** Uninstall removes binaries/service but preserves user config

---

### Phase 6: Completion & Polish
**Goal:** Final screens, error handling, install.sh wrapper

| Task | Description | Status |
|------|-------------|--------|
| 6.1 | Implement Complete screen (success message, next steps) | Pending |
| 6.2 | Implement error Complete screen (failure message, troubleshooting) | Pending |
| 6.3 | Add terminal size detection (minimum 80x24 warning) | Pending |
| 6.4 | Update `install.sh` to compile and run Go installer | Pending |
| 6.5 | Test full install/uninstall cycle | Pending |

**Deliverable:** Polished installer ready for use

---

## File Structure

```
cmd/installer/
└── main.go          # Single file (~800-1000 lines, following jellysink pattern)

install.sh           # Updated shell wrapper
```

---

## Dependencies

```
github.com/charmbracelet/bubbletea
github.com/charmbracelet/bubbles/spinner
github.com/charmbracelet/bubbles/textinput
github.com/charmbracelet/lipgloss
```
